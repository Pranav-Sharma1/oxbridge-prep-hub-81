generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  student
  tutor
  admin
}

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  role         Role     @default(student)
  passwordHash String
  createdAt    DateTime @default(now())
  tutorProfile TutorProfile?
  messagesSent Message[] @relation("sent")
  conversationsA Conversation[] @relation("a")
  conversationsB Conversation[] @relation("b")
}

model TutorProfile {
  id        String  @id @default(cuid())
  user      User    @relation(fields: [userId], references: [id])
  userId    String  @unique
  bio       String?
  subjects  String[] @default([])
  approved  Boolean @default(false)
  createdAt DateTime @default(now())
}

model Conversation {
  id        String    @id @default(cuid())
  a         User      @relation("a", fields: [aId], references: [id])
  aId       String
  b         User      @relation("b", fields: [bId], references: [id])
  bId       String
  messages  Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  @@unique([aId, bId])
}

model Message {
  id             String   @id @default(cuid())
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  conversationId String
  sender         User     @relation("sent", fields: [senderId], references: [id])
  senderId       String
  body           String
  createdAt      DateTime @default(now())
}
